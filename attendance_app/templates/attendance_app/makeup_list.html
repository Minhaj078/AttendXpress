{% extends 'attendance_app/base.html' %}
{% block title %}Makeup Classes â€“ EduTrack{% endblock %}
{% block topbar_title %}Makeup Classes{% endblock %}

{% block content %}
<div class="page-header">
  <div>
    <h1 class="page-title">Makeup Classes</h1>
    <p class="page-subtitle">All scheduled makeup sessions</p>
  </div>
  {% if profile.role == 'faculty' %}
  <a href="{% url 'schedule_makeup' %}" class="btn btn-primary"><i class="fas fa-plus"></i> Schedule Class</a>
  {% endif %}
</div>

<!-- Filters -->
<div class="card mb-4">
  <div class="card-body" style="padding:14px 20px">
    <form method="get" style="display:flex;gap:12px;flex-wrap:wrap;align-items:center">
      <div class="search-bar" style="flex:1;min-width:200px">
        <i class="fas fa-search"></i>
        <input type="text" name="search" class="form-control" placeholder="Search classes..." value="{{ search }}">
      </div>
      <select name="status" class="form-control" style="width:160px">
        <option value="">All Statuses</option>
        <option value="scheduled" {% if status_filter == 'scheduled' %}selected{% endif %}>Scheduled</option>
        <option value="active" {% if status_filter == 'active' %}selected{% endif %}>Active</option>
        <option value="completed" {% if status_filter == 'completed' %}selected{% endif %}>Completed</option>
        <option value="cancelled" {% if status_filter == 'cancelled' %}selected{% endif %}>Cancelled</option>
      </select>
      <button type="submit" class="btn btn-primary btn-sm">Filter</button>
      {% if status_filter or search %}<a href="{% url 'makeup_list' %}" class="btn btn-ghost btn-sm">Clear</a>{% endif %}
    </form>
  </div>
</div>

<!-- Class Grid -->
{% if classes %}
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:16px">
  {% for cls in classes %}
  <div class="card" style="transition:transform .2s,box-shadow .2s" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='var(--shadow-lg)'" onmouseout="this.style.transform='';this.style.boxShadow=''">
    <div class="card-body">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px">
        <span class="badge badge-{{ cls.status }}">
          {% if cls.status == 'active' %}<i class="fas fa-circle" style="font-size:.4rem"></i>{% endif %}
          {{ cls.get_status_display }}
        </span>
        <span style="font-size:.75rem;color:var(--text-muted)">{{ cls.course.code }}</span>
      </div>

      <h3 style="font-size:1rem;font-weight:700;margin-bottom:6px;line-height:1.3">{{ cls.title }}</h3>
      <p style="font-size:.8rem;color:var(--text-muted);margin-bottom:14px">{{ cls.course.name }}</p>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:14px">
        <div style="font-size:.78rem;color:var(--text-muted)"><i class="fas fa-calendar" style="color:var(--primary)"></i> {{ cls.scheduled_date|date:"M d, Y" }}</div>
        <div style="font-size:.78rem;color:var(--text-muted)"><i class="fas fa-clock" style="color:var(--secondary)"></i> {{ cls.start_time|time:"h:i A" }}</div>
        <div style="font-size:.78rem;color:var(--text-muted)"><i class="fas fa-map-marker-alt" style="color:var(--success)"></i> {{ cls.venue|truncatechars:18 }}</div>
        <div style="font-size:.78rem;color:var(--text-muted)"><i class="fas fa-users" style="color:var(--accent)"></i> {{ cls.attendance_count }}/{{ cls.course.students.count }}</div>
      </div>

      {% if profile.role == 'faculty' %}
      <div style="background:var(--surface2);border-radius:8px;padding:8px 12px;margin-bottom:12px;display:flex;align-items:center;justify-content:space-between">
        <code style="font-size:.85rem;font-weight:700;letter-spacing:3px;color:var(--primary)">{{ cls.remedial_code }}</code>
        <button onclick="navigator.clipboard.writeText('{{ cls.remedial_code }}')" style="background:none;border:none;cursor:pointer;color:var(--text-muted)" title="Copy code">
          <i class="fas fa-copy"></i>
        </button>
      </div>
      {% endif %}

      <div style="display:flex;gap:8px">
        <a href="{% url 'makeup_detail' cls.pk %}" class="btn btn-outline btn-sm" style="flex:1;justify-content:center">
          <i class="fas fa-eye"></i> View Details
        </a>
        {% if profile.role == 'student' and cls.status == 'active' %}
        <a href="{% url 'mark_attendance' %}" class="btn btn-success btn-sm">
          <i class="fas fa-qrcode"></i>
        </a>
        {% endif %}
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="card">
  <div class="empty-state" style="padding:64px 24px">
    <i class="fas fa-calendar-times"></i>
    <p style="margin-top:8px">No makeup classes found{% if search %} matching "{{ search }}"{% endif %}</p>
    {% if profile.role == 'faculty' %}
    <a href="{% url 'schedule_makeup' %}" class="btn btn-primary btn-sm mt-3">Schedule Your First Class</a>
    {% endif %}
  </div>
</div>
{% endif %}
{% endblock %}
